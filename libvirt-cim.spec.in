# -*- rpm-spec -*-

Summary: A CIM provider for libvirt
Name: libvirt-cim
Version: @PACKAGE_VERSION@
Release: 1%{?dist}%{?extra_release}
License: LGPLv2+
Group: Development/Libraries
Source: libvirt-cim-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
URL: http://libvirt.org/CIM/
Requires: libxml2
Requires: libvirt >= 0.2.3
BuildRequires: tog-pegasus-devel
BuildRequires: libvirt-devel >= 0.2.3
BuildRequires: e2fsprogs-devel
BuildRequires: libxml2-devel
BuildRequires: libcmpiutil-devel
BuildConflicts: sblim-cmpi-devel

%description
Libvirt-cim is a CMPI CIM provider that implements the DMTF SVPC
virtualization model. The goal is to support most of the features
exported by libvirt itself, enabling management of multiple
platforms with a single provider.

%prep
%setup -q
chmod -x src/* libxkutil/* schema/*

%build
%configure --disable-werror
make %{?_smp_mflags}

%install
rm -fr $RPM_BUILD_ROOT

make DESTDIR=$RPM_BUILD_ROOT install
rm -f $RPM_BUILD_ROOT%{_libdir}/*.la
rm -f $RPM_BUILD_ROOT%{_libdir}/*.a
rm -f $RPM_BUILD_ROOT%{_libdir}/cmpi/*.la
rm -f $RPM_BUILD_ROOT%{_libdir}/cmpi/*.a

%clean
rm -fr $RPM_BUILD_ROOT

%pre
%define REGISTRATION %{_datadir}/%{name}/*.registration
%define SCHEMA %{_datadir}/%{name}/*.mof

%{_datadir}/%{name}/provider-register.sh -d -t pegasus \
	-n /@CIM_VIRT_NS@ \
	-r %{REGISTRATION} -m %{SCHEMA} >/dev/null 2>&1 || true

%post
/sbin/ldconfig

%{_datadir}/%{name}/provider-register.sh -t pegasus \
	-n /@CIM_VIRT_NS@ \
	-r %{REGISTRATION} -m %{SCHEMA} || true

%preun
%{_datadir}/%{name}/provider-register.sh -d -t pegasus \
	-n /@CIM_VIRT_NS@ \
	-r %{REGISTRATION} -m %{SCHEMA} || true

%postun -p /sbin/ldconfig

%files 
%defattr(-, root, root)

%doc README doc/CodingStyle doc/SubmittingPatches
%doc provider-register.sh
%doc doc/*.html
%{_libdir}/lib*.so*
%{_libdir}/cmpi/lib*.so*
%{_datadir}/libvirt-cim/*.sh
%{_datadir}/libvirt-cim/*.mof
%{_datadir}/libvirt-cim/*.registration

%changelog
* Fri Oct 26 2007 Daniel Veillard <veillard@redhat.com> - 0.1-1
- created
